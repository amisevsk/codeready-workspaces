#!/usr/bin/env groovy

// build params
//extensions - comma separated list of extensions

node {
    stage 'build extensions'
    def extensions = "${extensions}"
    def jobs = []

    def extensionKeyValues = extensions.split(",")
    //def extensionMap= [:]
    //extensionsKeyValues.each {
    //
    //}

    extensionKeyValues.each { extension ->
        def buildjob = build job: 'vscode-extensions-packaging', parameters: [ string(name: 'extensionPath', value: extension.split("|")[0], string(name: 'extensionSource', value: extension.split("|")[1])]
        jobs.add(buildjob)
    }

    jobs.each { job ->
        copyArtifacts(projectName: 'vscode-extensions-packaging', selector: specific("${job.number}"))
    }

    sh "tar -cvf vscode-extensions-vsix.tar ."


    # TODO deploy artifact to pkgs.devel?

    archiveArtifacts artifacts: '*.tar', fingerprint: true
}
